---
title: postprocessing
description: API documentation for optimex.postprocessing
---

# postprocessing

Post-processing and visualization of optimization results.

This module provides tools to extract, process, and visualize results from solved
optimization models. The PostProcessor class handles denormalization of scaled
results, data extraction into DataFrames, and creation of publication-quality plots
for impacts, installation schedules, production, and operation profiles.

Key classes:
    - PostProcessor: Extract and visualize optimization results


## Classes

### `PostProcessor`

A class for post-processing and visualizing results from a solved Pyomo model.

    This class provides plotting utilities with configurable styles for generating
    visualizations such as stacked bar charts, line plots, etc., from model outputs.

    Parameters
    ----------
    solved_model : pyo.ConcreteModel
        A solved Pyomo model instance containing the data to be processed and visualized.

    plot_config : dict, optional
        A dictionary of plot styling options to override default settings. Recognized keys include:
            - "figsize" : tuple of (width, height) in inches
            - "fontsize" : int, font size for labels and titles
            - "grid_alpha" : float, transparency of grid lines
            - "grid_linestyle" : str, line style for grid (e.g., "--", ":", "-.")
            - "rotation" : int, angle of x-axis tick label rotation
            - "bar_width" : float, width of bars in bar charts
            - "colormap" : list of colors used for plotting
            - "line_color" : str, color of lines in line plots
            - "line_marker" : str, marker style for line plots
            - "line_width" : float, width of lines in line plots
            - "max_xticks" : int, maximum number of x-axis ticks to display

        Unrecognized keys are ignored.

    Attributes
    ----------
    m : pyo.ConcreteModel
        The solved Pyomo model.

    _plot_config : dict
        The finalized configuration dictionary used for plotting.


#### Methods

##### `__init__(self, solved_model: pyo.ConcreteModel, plot_config: dict)`

##### `get_demand(self) -> pd.DataFrame`

Extracts the demand data from the model and returns it as a DataFrame.
        The DataFrame will have a MultiIndex with 'Product' and 'Time'.
        The values are the demand for each Product at each time step.


##### `get_existing_capacity(self) -> pd.DataFrame`

Extract existing (brownfield) capacity data from the model.

        Returns a DataFrame showing which processes have existing capacity,
        when they were installed, and their operational status at each time step.

        Returns
        -------
        pd.DataFrame
            DataFrame with Time as index and (Process, Type) as MultiIndex columns.
            Type can be 'existing_capacity' (total existing) or 'existing_operating'
            (existing capacity in operation phase at that time).


##### `get_impacts(self) -> pd.DataFrame`

Extract environmental impacts by category, process, and time.

        Returns denormalized impact values from the solved optimization model,
        organized as a pivoted DataFrame with time as rows and (category, process)
        as column MultiIndex.

        Returns
        -------
        pd.DataFrame
            Pivoted DataFrame with 'Time' as index and MultiIndex columns for
            (Category, Process) combinations. Values represent environmental
            impacts in the units of the characterization method.


##### `get_installation(self) -> pd.DataFrame`

Extracts the installation data from the model and returns it as a DataFrame.
        The DataFrame will have a MultiIndex with 'Time' and 'Process'.
        The values are the installed capacities for each process at each time step.


##### `get_operation(self) -> pd.DataFrame`

Extracts the operation data from the model and returns it as a DataFrame.
        The DataFrame will have a MultiIndex with 'Time' and 'Process'.
        The values are the operational levels for each process at each time step.

        Note: var_operation is not scaled because when both demand and
        foreground_production are scaled by the same factor, the scaling
        cancels out in the constraint: demand = production * operation.


##### `get_production(self) -> pd.DataFrame`

Extracts the production data from the model and returns it as a DataFrame.
        The DataFrame will have a MultiIndex with 'Process', 'Product', and
        'Time'. The values are the total production for each process and product
        at each time step.


##### `get_production_capacity(self) -> pd.DataFrame`

Calculate maximum available production capacity for each product at each time step.

        Capacity is determined by counting installations in their operation phase and
        multiplying by their production coefficients. This includes both new installations
        (from var_installation) and existing (brownfield) capacity.

        Returns
        -------
        pd.DataFrame
            DataFrame with Time as index and Products as columns.
            Values represent maximum production capacity (not actual production).


##### `get_radiative_forcing(self) -> pd.DataFrame`

Extract radiative forcing time series from model results.

        This method is currently not implemented. It will extract the scaled inventory
        and compute radiative forcing profiles over time for climate impact assessment.

        Returns
        -------
        pd.DataFrame
            DataFrame with radiative forcing values over time.

        Raises
        ------
        NotImplementedError
            This method is not yet implemented.


##### `plot_impacts(self, df_impacts, annotated)`

Plot a stacked bar chart for impacts by category and process over time.

        Creates a figure with one subplot per impact category, showing process
        contributions as stacked bars. Automatically denormalizes scaled values
        and optionally displays human-readable process names.

        Parameters
        ----------
        df_impacts : DataFrame, optional
            DataFrame with Time as index, Categories and Processes as columns.
            Columns must be a MultiIndex: (Category, Process). If not provided,
            automatically extracted via get_impacts().
        annotated : bool, default=True
            If True, show human-readable names from Brightway database instead
            of process codes.


##### `plot_installation(self, df_installation, annotated)`

Plot a stacked bar chart for installation data.

        Parameters
        ----------
        df_installation : DataFrame, optional
            DataFrame with Time as index, Processes as columns
        annotated : bool, default=True
            If True, show human-readable names instead of codes


##### `plot_operation(self, df_operation, annotated)`

Plot a stacked bar chart for operation data.

        Parameters
        ----------
        df_operation : DataFrame, optional
            DataFrame with Time as index, Processes as columns
        annotated : bool, default=True
            If True, show human-readable names instead of codes


##### `plot_production_and_demand(self, prod_df, demand_df, annotated)`

Plot a stacked bar chart for production and line(s) for demand.

        Parameters
        ----------
        prod_df : DataFrame, optional
            DataFrame with Time as index, (Process, Product) as columns
        demand_df : DataFrame, optional
            DataFrame with Time as index, Products as columns
        annotated : bool, default=True
            If True, show human-readable names instead of codes


##### `plot_production_vs_capacity(self, product, prod_df, capacity_df, demand_df, annotated, show_grouped_bars)`

Plot actual production vs maximum available capacity for a specific product.

        Shows two lines:
        - Production (demand is assumed equal and overlaid)
        - Maximum available capacity (dashed line)

        Optionally shows grouped bars per time step:
        - Left bar: New capacity installations (stacked by process)
        - Right bar: Operation level (stacked by process)

        Parameters
        ----------
        product : str, optional
            Product to plot. If None, uses the first product with non-zero demand.
        prod_df : pd.DataFrame, optional
            Production DataFrame from get_production()
        capacity_df : pd.DataFrame, optional
            Capacity DataFrame from get_production_capacity()
        demand_df : pd.DataFrame, optional
            Demand DataFrame from get_demand()
        annotated : bool, default=True
            If True, show human-readable names instead of codes
        show_grouped_bars : bool, default=False
            If True, show grouped bars for capacity installations and operation


##### `plot_utilization_heatmap(self, product, annotated, show_values)`

Plot a heatmap showing capacity utilization by process over time.

        This provides a clean, dedicated view of which processes are being
        operated vs sitting idle at each time step.

        Parameters
        ----------
        product : str, optional
            Product to analyze. If None, uses the first product with non-zero demand.
        annotated : bool, default=True
            If True, show human-readable process names instead of codes.
        show_values : bool, default=True
            If True, show utilization percentages in cells.

