/* ============================================================================
   OPTIMEX DOCUMENTATION - CUSTOM STYLES
   ============================================================================ */

/* ============================================================================
   1. CSS VARIABLES & GLOBAL
   ============================================================================ */

html {
    scroll-behavior: smooth;
}

[data-md-color-scheme="slate"] {
    --md-default-bg-color: #0B0C0F;
}

/* ============================================================================
   2. HEADER, NAVIGATION & FOOTER - GLASSMORPHISM
   ============================================================================ */

/* Light mode */
[data-md-color-scheme="default"] .md-header,
[data-md-color-scheme="default"] .md-tabs {
    background-color: rgba(255, 255, 255, 0.75) !important;
    backdrop-filter: blur(8px) saturate(1.5);
    -webkit-backdrop-filter: blur(8px) saturate(1.5);
}

[data-md-color-scheme="default"] .md-footer {
    background-color: rgba(255, 255, 255, 0.75) !important;
    backdrop-filter: blur(8px) saturate(1.5);
    -webkit-backdrop-filter: blur(8px) saturate(1.5);
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0, 0, 0, 0.87);
}

[data-md-color-scheme="default"] .md-footer a,
[data-md-color-scheme="default"] .md-footer-nav__link,
[data-md-color-scheme="default"] .md-footer-nav__title,
[data-md-color-scheme="default"] .md-footer-nav__direction {
    color: rgba(0, 0, 0, 0.87);
}

[data-md-color-scheme="default"] .md-footer-meta,
[data-md-color-scheme="default"] .md-footer-meta * {
    background-color: transparent !important;
    color: rgba(0, 0, 0, 0.6) !important;
}

[data-md-color-scheme="default"] .md-footer-meta svg {
    fill: rgba(0, 0, 0, 0.6) !important;
}

[data-md-color-scheme="default"] .md-social__link svg {
    fill: rgba(0, 0, 0, 0.6) !important;
}

/* Dark mode */
[data-md-color-scheme="slate"] .md-header {
    background-color: rgba(11, 12, 15, 0.75) !important;
    backdrop-filter: blur(8px) saturate(1.5);
    -webkit-backdrop-filter: blur(8px) saturate(1.5);
    box-shadow: none !important;
}

[data-md-color-scheme="slate"] .md-tabs {
    background-color: rgba(11, 12, 15, 0.75) !important;
    backdrop-filter: blur(8px) saturate(1.5);
    -webkit-backdrop-filter: blur(8px) saturate(1.5);
}

[data-md-color-scheme="slate"] .md-footer {
    background-color: rgba(11, 12, 15, 0.75) !important;
    backdrop-filter: blur(8px) saturate(1.5);
    -webkit-backdrop-filter: blur(8px) saturate(1.5);
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

/* Header border when scrolled (tabs hidden) */
[data-md-color-scheme="slate"] .md-header--shadow {
    border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
    box-shadow: none !important;
}

/* ============================================================================
   3. HEADER ELEMENTS
   ============================================================================ */

/* Logo */
.md-header__button.md-logo {
    padding: 0 0.4rem !important;
    margin: 0 !important;
}

.md-header__button.md-logo img,
.md-header__button.md-logo svg {
    height: 30px;
    width: auto;
    padding: 0 !important;
    margin: 0 !important;
}

/* Title */
.md-header__title {
    margin-left: 10px !important;
}

.md-header__topic:first-child {
    font-family: "Consolas", "Roboto Mono", monospace !important;
    text-transform: lowercase;
    font-weight: 700;
}

.md-header__topic:not(:first-child) {
    font-family: var(--md-text-font-family, "Inter", sans-serif);
    text-transform: none;
    font-weight: normal;
}

/* Theme toggle - muted */
[data-md-color-scheme="slate"] .md-header__button[for="__palette_0"] {
    color: rgba(255, 255, 255, 0.7);
}

[data-md-color-scheme="default"] .md-header__button[for="__palette_1"] {
    color: rgba(0, 0, 0, 0.87);
}

/* ============================================================================
   4. NAVIGATION TABS
   ============================================================================ */

.md-tabs {
    position: relative;
    border-bottom: none !important;
}

/* Border line (pseudo-element for z-index control) */
.md-tabs::after {
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    height: 1px;
    z-index: 1;
}

[data-md-color-scheme="default"] .md-tabs::after {
    background-color: rgba(0, 0, 0, 0.07);
}

[data-md-color-scheme="slate"] .md-tabs::after {
    background-color: rgba(255, 255, 255, 0.1);
}

/* Tab list and items */
.md-tabs__list {
    display: flex;
    align-items: stretch;
    overflow: visible !important;
}

.md-tabs__item {
    display: flex;
    height: 2rem;
    padding: 0;
    margin: 0 0.2rem;
    overflow: visible !important;
}

/* Tab links */
.md-tabs__link {
    display: flex;
    align-items: center;
    padding: 0 0.5rem;
    margin: 0;
    height: 100%;
    position: relative;
    z-index: 2;
    transition: all 0.25s ease;
    border-radius: 0.5rem;
    overflow: visible !important;
}

/* Hover background (pseudo-element for size control) */
.md-tabs__link::before {
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    top: 0.3rem;
    bottom: 0.3rem;
    border-radius: 0.4rem;
    background-color: transparent;
    transition: background-color 0.25s ease;
    z-index: -1;
}

[data-md-color-scheme="slate"] .md-tabs__link:hover::before {
    background-color: rgba(255, 255, 255, 0.05);
}

[data-md-color-scheme="default"] .md-tabs__link:hover::before {
    background-color: rgba(0, 0, 0, 0.05);
}

/* Active state */
.md-tabs__item--active .md-tabs__link {
    text-shadow: 0.5px 0 0 currentColor;
    font-weight: 400;
}

/* Active indicator */
.md-tabs__item--active .md-tabs__link::after {
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    height: 2px;
    border-radius: 1px;
    background-color: var(--md-accent-fg-color);
    transition: all 0.3s ease;
    z-index: 10;
}

/* Mobile navigation backgrounds */
.md-nav__title,
.md-nav__source,
.md-nav--primary .md-nav__title,
.md-nav--primary .md-nav__title[for="__drawer"] {
    background-color: var(--md-default-bg-color) !important;
}

/* ============================================================================
   4b. MOBILE NAVIGATION - INLINE EXPAND (Override drill-down behavior)
   ============================================================================ */

/* Only apply on mobile (when drawer is used) */
@media screen and (max-width: 76.1875em) {
    /* Prevent the drill-down sliding effect */
    .md-nav--primary .md-nav__list {
        transform: none !important;
        transition: none !important;
    }

    /* Keep all navigation levels visible in the DOM flow */
    .md-nav--primary .md-nav--secondary,
    .md-nav--primary .md-nav__item--nested > .md-nav {
        position: static !important;
        transform: none !important;
        opacity: 1 !important;
        overflow: hidden;
        max-height: 0;
        transition: max-height 0.25s ease-out;
    }

    /* When a nested nav is toggled open, expand it */
    .md-nav--primary .md-nav__toggle:checked ~ .md-nav {
        max-height: 1000px;
        transition: max-height 0.35s ease-in;
    }

    /* Hide the back button / drill-down title for nested sections */
    .md-nav--primary .md-nav--secondary > .md-nav__title,
    .md-nav--primary .md-nav__item--nested > .md-nav > .md-nav__title {
        display: none !important;
    }

    /* Keep the main drawer title visible */
    .md-nav--primary > .md-nav__title[for="__drawer"] {
        display: flex !important;
    }

    /* Style the expand arrow on parent items */
    .md-nav--primary .md-nav__item--nested > .md-nav__link {
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    /* Add expand/collapse arrow indicator */
    .md-nav--primary .md-nav__item--nested > .md-nav__link::after {
        content: "";
        display: inline-block;
        width: 0.5rem;
        height: 0.5rem;
        border-right: 2px solid currentColor;
        border-bottom: 2px solid currentColor;
        transform: rotate(-45deg);
        transition: transform 0.2s ease;
        flex-shrink: 0;
        margin-left: 0.5rem;
        opacity: 0.6;
    }

    /* Rotate arrow when expanded */
    .md-nav--primary .md-nav__toggle:checked ~ .md-nav__link::after {
        transform: rotate(45deg);
    }

    /* Indent nested items */
    .md-nav--primary .md-nav__item--nested > .md-nav > .md-nav__list {
        padding-left: 0.8rem;
        border-left: 1px solid rgba(128, 128, 128, 0.2);
        margin-left: 0.8rem;
    }

    /* Ensure nested links don't have the arrow */
    .md-nav--primary .md-nav__item:not(.md-nav__item--nested) > .md-nav__link::after {
        display: none;
    }

    /* Remove transforms from the primary nav that cause drill-down */
    .md-nav--primary,
    .md-nav--primary .md-nav {
        transform: none !important;
    }

    /* Prevent the "lifted" state from hiding siblings */
    .md-nav--lifted > .md-nav__list > .md-nav__item--active ~ .md-nav__item,
    .md-nav--lifted > .md-nav__list > .md-nav__item:not(.md-nav__item--active) {
        display: block !important;
        opacity: 1 !important;
        transform: none !important;
    }

    /* Keep all items visible when any is active */
    .md-nav--lifted > .md-nav__list {
        transform: none !important;
    }

    .md-nav--lifted > .md-nav__list > .md-nav__item {
        opacity: 1 !important;
        transform: none !important;
    }

    /* Override the lifted nav title behavior */
    .md-nav--lifted > .md-nav__title {
        display: none !important;
    }

    .md-nav--lifted[data-md-level="0"] > .md-nav__title {
        display: flex !important;
    }
}

/* ============================================================================
   5. SEARCH
   ============================================================================ */

.md-search {
    padding: 6px 0;
}

.md-search__form,
.md-search__input {
    border-radius: 0.5rem;
}

.md-search__input::placeholder {
    font-size: 0.7rem;
}

.md-search__inner {
    border-radius: 0.5rem;
}

.md-search__output,
.md-search__scrollwrap {
    border-radius: 0 0 0.5rem 0.5rem;
}

/* Expanded search */
[data-md-toggle="search"]:checked ~ .md-header .md-search__form {
    border-radius: 0.5rem 0.5rem 0 0;
}

[data-md-toggle="search"]:checked ~ .md-header .md-search__inner {
    border-radius: 0.5rem;
}

/* Search field - dark mode */
[data-md-color-scheme="slate"] .md-search__form {
    background-color: rgba(255, 255, 255, 0.08);
}

/* Search icon - muted */
[data-md-color-scheme="slate"] .md-search__icon {
    color: rgba(255, 255, 255, 0.5);
}

[data-md-color-scheme="default"] .md-search__icon {
    color: rgba(0, 0, 0, 0.5);
}

/* Search results */
.md-search-result__article {
    border-radius: 0.4rem;
}

/* ============================================================================
   6. SEARCH OVERLAY & BLUR EFFECTS
   ============================================================================ */

/* Disable glassmorphism when search is open */
[data-md-toggle="search"]:checked ~ .md-header,
[data-md-toggle="search"]:checked ~ .md-header .md-tabs {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    background-color: var(--md-default-bg-color) !important;
}

/* Blur background content */
[data-md-toggle="search"]:checked ~ .md-container,
[data-md-toggle="search"]:checked ~ .md-main {
    filter: blur(6px);
    transition: filter 0.2s ease;
}

/* Blur header elements except search */
[data-md-toggle="search"]:checked ~ .md-header .md-header__button.md-logo,
[data-md-toggle="search"]:checked ~ .md-header .md-header__title,
[data-md-toggle="search"]:checked ~ .md-header .md-header__option,
[data-md-toggle="search"]:checked ~ .md-header .md-header__source {
    filter: blur(6px);
    transition: filter 0.2s ease;
}

/* Search overlay */
.md-search__overlay {
    background-color: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
}

/* ============================================================================
   7. BORDER RADIUS - GLOBAL
   ============================================================================ */

/* Code blocks */
.md-typeset pre > code,
.md-typeset code {
    border-radius: 0.4rem;
}

.md-typeset pre,
.highlight {
    border-radius: 0.5rem;
    overflow: hidden;
}

/* Admonitions */
.md-typeset .admonition,
.md-typeset details {
    border-radius: 0.5rem;
}

.md-typeset .admonition-title,
.md-typeset summary {
    border-radius: 0.5rem 0.5rem 0 0;
}

/* Tables */
.md-typeset table:not([class]) {
    border-radius: 0.5rem;
    overflow: hidden;
}

.md-typeset table:not([class]) th:first-child {
    border-top-left-radius: 0.5rem;
}

.md-typeset table:not([class]) th:last-child {
    border-top-right-radius: 0.5rem;
}

.md-typeset table:not([class]) tr:last-child td:first-child {
    border-bottom-left-radius: 0.5rem;
}

.md-typeset table:not([class]) tr:last-child td:last-child {
    border-bottom-right-radius: 0.5rem;
}

/* Cards and tabs */
.md-typeset .tabbed-block,
.tabbed-set,
.md-typeset .grid.cards > ul > li,
.md-typeset .grid.cards > ol > li {
    border-radius: 0.5rem;
}

/* Card hover effect - dark mode */
[data-md-color-scheme="slate"] .md-typeset .grid.cards > ul > li,
[data-md-color-scheme="slate"] .md-typeset .grid.cards > ol > li {
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: none;
    transition: border-color 0.25s ease, box-shadow 0.25s ease;
}

[data-md-color-scheme="slate"] .md-typeset .grid.cards > ul > li:hover,
[data-md-color-scheme="slate"] .md-typeset .grid.cards > ol > li:hover {
    border-color: rgba(255, 255, 255, 0.05);
    box-shadow: 0px 4px 10px 0px rgba(0, 0, 0, 0.95);
}

/* Card heading icons - add right margin */
.md-typeset .grid.cards > ul > li > p:first-child .twemoji,
.md-typeset .grid.cards > ol > li > p:first-child .twemoji {
    margin-right: 0.4rem;
}

.tabbed-set > input:checked + label {
    border-bottom-color: var(--md-accent-fg-color);
}

/* Add top margin to code blocks directly under tabs */
.tabbed-block > .highlight:first-child,
.tabbed-set .tabbed-content > .highlight:first-child,
.md-typeset .tabbed-block > pre:first-child,
.md-typeset .tabbed-block > .highlight:first-child {
    margin-top: 1em !important;
}

/* Buttons */
.md-typeset .md-button {
    border-radius: 0.4rem;
}

/* Tooltips and annotations */
.md-tooltip {
    border-radius: 0.4rem;
}

.md-annotation__index {
    border-radius: 0.3rem;
}

/* ============================================================================
   8. CODE BLOCKS - THEME COLORS
   ============================================================================ */

/* Dark mode */
[data-md-color-scheme="slate"] .highlight {
    background-color: rgba(255, 255, 255, 0.05) !important;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

[data-md-color-scheme="slate"] .highlight code {
    background-color: transparent !important;
}

/* Light mode */
[data-md-color-scheme="default"] .highlight {
    background-color: rgba(0, 0, 0, 0.03) !important;
    border: 1px solid rgba(0, 0, 0, 0.08);
}

[data-md-color-scheme="default"] .highlight code {
    background-color: transparent !important;
}

.md-code__nav {
    background-color: transparent !important;
}

[data-md-color-scheme="default"]
.md-code__button {
    color:  rgba(0, 0, 0, 0.2);
}

[data-md-color-scheme="slate"]
.md-code__button {
    color:  rgba(255, 255, 255, 0.2);
}

/* ============================================================================
   9. JUPYTER NOTEBOOKS
   ============================================================================ */

/* Fix heading width issue caused by action buttons */
.jp-RenderedHTMLCommon h1,
.jp-RenderedHTMLCommon h2,
.jp-RenderedHTMLCommon h3 {
    clear: both;
    width: 100% !important;
    max-width: 100% !important;
}

/* Ensure notebook content uses full width */
.jp-Notebook {
    width: 100% !important;
    max-width: 100% !important;
}

/* Hide prompts */
.jp-InputPrompt,
.jp-OutputPrompt {
    display: none !important;
}

/* Input area */
.jp-InputArea,
.jp-InputArea-editor {
    border-radius: 0.5rem !important;
    overflow-x: scroll !important;
}

.jp-CodeMirrorEditor pre {
    overflow-x: scroll !important;
}

/* Dark mode */
[data-md-color-scheme="slate"] .jp-CodeMirrorEditor {
    background-color: rgba(255, 255, 255, 0.05) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
}

[data-md-color-scheme="slate"] .jp-CodeMirrorEditor-editor,
[data-md-color-scheme="slate"] .jp-CodeMirrorEditor .highlight-ipynb {
    background-color: transparent !important;
    border: none !important;
}

/* Light mode */
[data-md-color-scheme="default"] .jp-CodeMirrorEditor {
    background-color: rgba(0, 0, 0, 0.03) !important;
    border: 1px solid rgba(0, 0, 0, 0.08) !important;
}

[data-md-color-scheme="default"] .jp-CodeMirrorEditor-editor,
[data-md-color-scheme="default"] .jp-CodeMirrorEditor .highlight-ipynb {
    background-color: transparent !important;
    border: none !important;
}

/* ============================================================================
   10. MISC
   ============================================================================ */

/* Spacing */
.md-typeset h1 {
    margin-top: 0;
}

.md-content__inner {
    padding-bottom: 3rem;
}

/* Back to top button - dark mode */
[data-md-color-scheme="slate"] .md-top {
    border: 1px solid rgba(255, 255, 255, 0.15);
}

.md-top {
    padding: 4px 8px;
    border-radius: 0.5rem;
}

/* ============================================================================
   11. LUCIDE ICONS FIX
   ============================================================================ */

/* Lucide icons are stroke-based - only target SVGs with lucide class */
svg[class*="lucide"] {
    fill: none !important;
    stroke: currentColor !important;
}

svg[class*="lucide"] path,
svg[class*="lucide"] circle,
svg[class*="lucide"] rect,
svg[class*="lucide"] line,
svg[class*="lucide"] polyline {
    fill: none !important;
}

/* Navigation sidebar icons - only those with stroke attribute */
.md-nav__link svg[stroke="currentColor"],
.md-nav__link svg[stroke="currentColor"] path,
.md-nav__link svg[stroke="currentColor"] circle {
    fill: none !important;
}
